<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Svarni Admin | Upload Products</title>
    <link rel="stylesheet" href="assets/css/style.css">
    
    <style>
        body { background-color: #f4f4f4; display: flex; justify-content: center; align-items: center; min-height: 100vh; font-family: sans-serif; }
        .admin-box {
            background: white; padding: 40px; border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 450px;
        }
        h2 { text-align: center; color: #0f281e; margin-bottom: 25px; }
        input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { 
            width: 100%; padding: 14px; background: #0f281e; color: white; border: none; 
            border-radius: 6px; cursor: pointer; font-size: 1rem; transition: 0.3s;
        }
        button:hover { background: #D4AF37; }
        #status { text-align: center; margin-top: 15px; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div class="admin-box">
        <h2>Add New Product</h2>
        <input type="text" id="pName" placeholder="Product Name (e.g. Kamal Bugdi)">
        <input type="number" id="pPrice" placeholder="Price (e.g. 149)">
        <input type="file" id="pImage" accept="image/*">
        
        <button id="uploadBtn" onclick="uploadProduct()">Upload Product</button>
        <p id="status"></p>
        <a href="index.html" style="display:block; text-align:center; margin-top:15px; color:#666; text-decoration:none;">Back to Website</a>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage-compat.js"></script>

    <script>
        // Your Keys (I pasted them from your screenshot)
        const firebaseConfig = {
            apiKey: "AIzaSyCJrBwg0RW4Z7eQvEOkTgyyM7DDdu_YzJM",
            authDomain: "svarni-jewelry.firebaseapp.com",
            projectId: "svarni-jewelry",
            storageBucket: "svarni-jewelry.firebasestorage.app",
            messagingSenderId: "1073048278419",
            appId: "1:1073048278419:web:db29ddafc54d6018a64466",
            measurementId: "G-6ME9S5M38C"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // The Upload Function
        async function uploadProduct() {
            const name = document.getElementById('pName').value;
            const price = document.getElementById('pPrice').value;
            const file = document.getElementById('pImage').files[0];
            const status = document.getElementById('status');

            if (!name || !price || !file) {
                alert("Please fill all details!");
                return;
            }

            status.innerText = "Attempting Upload... ‚è≥";
            status.style.color = "blue";

            try {
                // 1. Upload Image
                const storageRef = storage.ref('products/' + file.name);
                await storageRef.put(file);
                const url = await storageRef.getDownloadURL();
                console.log("Image Uploaded: ", url);

                // 2. Save to Database
                status.innerText = "Saving Data... üíæ";
                await db.collection("products").add({
                    name: name, 
                    price: price, 
                    image: url,
                    createdAt: new Date()
                });

                status.innerText = "‚úÖ Product Added Successfully!";
                status.style.color = "green";
                
                // Clear Form
                document.getElementById('pName').value = "";
                document.getElementById('pPrice').value = "";
                document.getElementById('pImage').value = "";

            } catch (err) {
                console.error("Firebase Error:", err);
                status.innerText = "‚ùå Failed: " + err.message;
                status.style.color = "red";
                alert(err.message); // This will pop up if there is an error
            }
        }
    </script>
</body>
</html>